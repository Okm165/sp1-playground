#![no_main]

extern crate curta_zkvm;

curta_zkvm::entrypoint!(main);

extern "C" {
    fn syscall_ed_add(p: *mut u32, q: *const u32);
}

// let p_ptr = self.bytes.as_mut_ptr() as *mut u32;
// let q_ptr = other.bytes.as_ptr() as *const u32;

pub fn main() {
    // 15112221349535400772501151409588531511454012693041857206046113283949847762202
    // 46316835694926478169428394003475163141307993866256225615783033603165251855960
    let mut ec: [u8; 64] = [
        26, 213, 37, 143, 96, 45, 86, 201, 178, 167, 37, 149, 96, 199, 44, 105, 92, 220, 214, 253,
        49, 226, 164, 192, 254, 83, 110, 205, 211, 54, 105, 33, 88, 102, 102, 102, 102, 102, 102,
        102, 102, 102, 102, 102, 102, 102, 102, 102, 102, 102, 102, 102, 102, 102, 102, 102, 102,
        102, 102, 102, 102, 102, 102, 102,
    ];

    // 24727413235106541002554574571675588834622768167397638456726423682521233608206
    // 15549675580280190176352668710449542251549572066445060580507079593062643049417:
    let doubled: [u8; 64] = [
        14, 206, 67, 40, 78, 161, 197, 131, 95, 164, 215, 21, 69, 142, 13, 8, 172, 231, 51, 24,
        125, 59, 4, 61, 108, 4, 90, 159, 76, 56, 171, 54, 201, 163, 248, 106, 174, 70, 95, 14, 86,
        81, 56, 100, 81, 15, 57, 151, 86, 31, 162, 201, 232, 94, 162, 29, 194, 41, 35, 9, 243, 205,
        96, 34,
    ];

    // let copy: [u8; 64] = [
    //     26, 213, 37, 143, 96, 45, 86, 201, 178, 167, 37, 149, 96, 199, 44, 105, 92, 220, 214, 253,
    //     49, 226, 164, 192, 254, 83, 110, 205, 211, 54, 105, 33, 88, 102, 102, 102, 102, 102, 102,
    //     102, 102, 102, 102, 102, 102, 102, 102, 102, 102, 102, 102, 102, 102, 102, 102, 102, 102,
    //     102, 102, 102, 102, 102, 102, 102,
    // ];

    let p_ptr = ec.as_mut_ptr() as *mut u32;
    // let q_ptr = copy.as_ptr() as *const u32;

    println!("p_ptr = {:p}", p_ptr);
    // println!("q_ptr = {:p}", q_ptr);

    unsafe {
        syscall_ed_add(p_ptr, p_ptr);
        syscall_ed_add(p_ptr, p_ptr);
        syscall_ed_add(p_ptr, p_ptr);
        syscall_ed_add(p_ptr, p_ptr);
    }

    assert_eq!(ec, doubled);
    println!("done");
}
